THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){function e(e){(a=function(){if(l===x){var e=new THREE.RenderableObject;return v.push(e),x++,l++,e}return v[l++]}()).id=e.id,a.object=e,V.setFromMatrixPosition(e.matrixWorld),V.applyMatrix4(B),a.z=V.z,a.renderOrder=e.renderOrder,z.objects.push(a)}function r(e,r,t){var i=1/e.w;e.z*=i,e.z>=-1&&e.z<=1&&((u=function(){if(m===M){var e=new THREE.RenderableSprite;return b.push(e),M++,m++,e}return b[m++]}()).id=r.id,u.x=e.x*i,u.y=e.y*i,u.z=e.z,u.renderOrder=r.renderOrder,u.object=r,u.rotation=r.rotation,u.scale.x=r.scale.x*Math.abs(u.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),u.scale.y=r.scale.y*Math.abs(u.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),u.material=r.material,z.elements.push(u))}function t(){if(p===T){var e=new THREE.RenderableVertex;return R.push(e),T++,p++,e}return R[p++]}function i(){if(f===g){var e=new THREE.RenderableFace;return S.push(e),g++,f++,e}return S[f++]}function o(){if(h===w){var e=new THREE.RenderableLine;return H.push(e),w++,h++,e}return H[h++]}function n(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}function s(e,r){var t=0,i=1,o=e.z+e.w,n=r.z+r.w,s=-e.z+e.w,a=-r.z+r.w;return o>=0&&n>=0&&s>=0&&a>=0||!(o<0&&n<0||s<0&&a<0)&&(o<0?t=Math.max(t,o/(o-n)):n<0&&(i=Math.min(i,o/(o-n))),s<0?t=Math.max(t,s/(s-a)):a<0&&(i=Math.min(i,s/(s-a))),!(i<t||(e.lerp(r,t),r.lerp(e,1-i),0)))}var a,l,c,p,E,f,d,h,u,m,y,v=[],x=0,R=[],T=0,S=[],g=0,H=[],w=0,b=[],M=0,z={objects:[],lights:[],elements:[]},V=new THREE.Vector3,C=new THREE.Vector4,j=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),O=new THREE.Box3,L=new Array(3),k=new THREE.Matrix4,B=new THREE.Matrix4,P=new THREE.Matrix4,W=new THREE.Matrix3,A=new THREE.Frustum,F=new THREE.Vector4,G=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var N=new function(){function e(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(y),i.copy(t).applyMatrix4(B);var o=1/i.w;i.x*=o,i.y*=o,i.z*=o,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function r(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(L[0]=e.positionScreen,L[1]=r.positionScreen,L[2]=t.positionScreen,j.intersectsBox(O.setFromPoints(L)))}function n(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}var a=[],l=[],p=[],f=null,h=new THREE.Matrix3;return{setObject:function(e){f=e,h.getNormalMatrix(f.matrixWorld),a.length=0,l.length=0,p.length=0},projectVertex:e,checkTriangleVisibility:r,checkBackfaceCulling:n,pushVertex:function(r,i,o){(c=t()).position.set(r,i,o),e(c)},pushNormal:function(e,r,t){a.push(e,r,t)},pushColor:function(e,r,t){l.push(e,r,t)},pushUv:function(e,r){p.push(e,r)},pushLine:function(e,r){var t=R[e],i=R[r];t.positionScreen.copy(t.position).applyMatrix4(P),i.positionScreen.copy(i.position).applyMatrix4(P),!0===s(t.positionScreen,i.positionScreen)&&(t.positionScreen.multiplyScalar(1/t.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(d=o()).id=f.id,d.v1.copy(t),d.v2.copy(i),d.z=Math.max(t.positionScreen.z,i.positionScreen.z),d.renderOrder=f.renderOrder,d.material=f.material,f.material.vertexColors===THREE.VertexColors&&(d.vertexColors[0].fromArray(l,3*e),d.vertexColors[1].fromArray(l,3*r)),z.elements.push(d))},pushTriangle:function(e,t,o,s){var c=R[e],d=R[t],u=R[o];if(!1!==r(c,d,u)&&(s.side===THREE.DoubleSide||!0===n(c,d,u))){(E=i()).id=f.id,E.v1.copy(c),E.v2.copy(d),E.v3.copy(u),E.z=(c.positionScreen.z+d.positionScreen.z+u.positionScreen.z)/3,E.renderOrder=f.renderOrder,V.subVectors(u.position,d.position),C.subVectors(c.position,d.position),V.cross(C),E.normalModel.copy(V),E.normalModel.applyMatrix3(h).normalize();for(var m=0;m<3;m++){var y=E.vertexNormalsModel[m];y.fromArray(a,3*arguments[m]),y.applyMatrix3(h).normalize(),E.uvs[m].fromArray(p,2*arguments[m])}E.vertexNormalsLength=3,E.material=s,s.vertexColors!==THREE.FaceColors&&s.vertexColors!==THREE.VertexColors||E.color.fromArray(l,3*e),z.elements.push(E)}}}};this.projectScene=function(a,c,u,v){f=0,h=0,m=0,z.elements.length=0,!0===a.autoUpdate&&a.updateMatrixWorld(),null===c.parent&&c.updateMatrixWorld(),k.copy(c.matrixWorldInverse),B.multiplyMatrices(c.projectionMatrix,k),A.setFromMatrix(B),l=0,z.objects.length=0,z.lights.length=0,function r(t){if(!1!==t.visible){if(t instanceof THREE.Light)z.lights.push(t);else if(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Points){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===A.intersectsObject(t))return;e(t)}else if(t instanceof THREE.Sprite){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===A.intersectsSprite(t))return;e(t)}for(var i=t.children,o=0,n=i.length;o<n;o++)r(i[o])}}(a),!0===u&&z.objects.sort(n);for(var x=z.objects,T=0,S=x.length;T<S;T++){var g=x[T].object,H=g.geometry;if(N.setObject(g),y=g.matrixWorld,p=0,g instanceof THREE.Mesh){if(H instanceof THREE.BufferGeometry){var w=g.material,b=Array.isArray(w),M=H.attributes,j=H.groups;if(void 0===M.position)continue;for(var O=0,L=(be=M.position.array).length;O<L;O+=3){var D=be[O],I=be[O+1],U=be[O+2];if(!0===w.morphTargets)for(var X=H.morphAttributes.position,Y=H.morphTargetsRelative,Z=g.morphTargetInfluences,q=0,Q=X.length;q<Q;q++)if(0!==(le=Z[q])){var J=X[q];Y?(D+=J.getX(O/3)*le,I+=J.getY(O/3)*le,U+=J.getZ(O/3)*le):(D+=(J.getX(O/3)-be[O])*le,I+=(J.getY(O/3)-be[O+1])*le,U+=(J.getZ(O/3)-be[O+2])*le)}N.pushVertex(D,I,U)}if(void 0!==M.normal){var K=M.normal.array;for(O=0,L=K.length;O<L;O+=3)N.pushNormal(K[O],K[O+1],K[O+2])}if(void 0!==M.color)for(O=0,L=(He=M.color.array).length;O<L;O+=3)N.pushColor(He[O],He[O+1],He[O+2]);if(void 0!==M.uv){var $=M.uv.array;for(O=0,L=$.length;O<L;O+=2)N.pushUv($[O],$[O+1])}if(null!==H.index){var _=H.index.array;if(j.length>0)for(var ee=0;ee<j.length;ee++){var re=j[ee];if(void 0!==(w=!0===b?g.material[re.materialIndex]:g.material))for(O=re.start,L=re.start+re.count;O<L;O+=3)N.pushTriangle(_[O],_[O+1],_[O+2],w)}else for(O=0,L=_.length;O<L;O+=3)N.pushTriangle(_[O],_[O+1],_[O+2],w)}else if(j.length>0){for(ee=0;ee<j.length;ee++)if(re=j[ee],void 0!==(w=!0===b?g.material[re.materialIndex]:g.material))for(O=re.start,L=re.start+re.count;O<L;O+=3)N.pushTriangle(O,O+1,O+2,w)}else for(O=0,L=be.length/3;O<L;O+=3)N.pushTriangle(O,O+1,O+2,w)}else if(H instanceof THREE.Geometry){var te=H.vertices,ie=H.faces,oe=H.faceVertexUvs[0];W.getNormalMatrix(y),w=g.material,b=Array.isArray(w);for(var ne=0,se=te.length;ne<se;ne++){var ae=te[ne];if(V.copy(ae),!0===w.morphTargets)for(X=H.morphTargets,Z=g.morphTargetInfluences,q=0,Q=X.length;q<Q;q++){var le;if(0!==(le=Z[q])){var ce=(J=X[q]).vertices[ne];V.x+=(ce.x-ae.x)*le,V.y+=(ce.y-ae.y)*le,V.z+=(ce.z-ae.z)*le}}N.pushVertex(V.x,V.y,V.z)}for(var pe=0,Ee=ie.length;pe<Ee;pe++){var fe=ie[pe];if(void 0!==(w=!0===b?g.material[fe.materialIndex]:g.material)){var de=w.side,he=R[fe.a],ue=R[fe.b],me=R[fe.c];if(!1!==N.checkTriangleVisibility(he,ue,me)){var ye=N.checkBackfaceCulling(he,ue,me);if(de!==THREE.DoubleSide){if(de===THREE.FrontSide&&!1===ye)continue;if(de===THREE.BackSide&&!0===ye)continue}(E=i()).id=g.id,E.v1.copy(he),E.v2.copy(ue),E.v3.copy(me),E.normalModel.copy(fe.normal),!1!==ye||de!==THREE.BackSide&&de!==THREE.DoubleSide||E.normalModel.negate(),E.normalModel.applyMatrix3(W).normalize();for(var ve=fe.vertexNormals,xe=0,Re=Math.min(ve.length,3);xe<Re;xe++){var Te=E.vertexNormalsModel[xe];Te.copy(ve[xe]),!1!==ye||de!==THREE.BackSide&&de!==THREE.DoubleSide||Te.negate(),Te.applyMatrix3(W).normalize()}E.vertexNormalsLength=ve.length;var Se=oe[pe];if(void 0!==Se)for(var ge=0;ge<3;ge++)E.uvs[ge].copy(Se[ge]);E.color=fe.color,E.material=w,E.z=(he.positionScreen.z+ue.positionScreen.z+me.positionScreen.z)/3,E.renderOrder=g.renderOrder,z.elements.push(E)}}}}}else if(g instanceof THREE.Line){if(P.multiplyMatrices(B,y),H instanceof THREE.BufferGeometry){if(void 0!==(M=H.attributes).position){for(O=0,L=(be=M.position.array).length;O<L;O+=3)N.pushVertex(be[O],be[O+1],be[O+2]);if(void 0!==M.color){var He;for(O=0,L=(He=M.color.array).length;O<L;O+=3)N.pushColor(He[O],He[O+1],He[O+2])}if(null!==H.index)for(O=0,L=(_=H.index.array).length;O<L;O+=2)N.pushLine(_[O],_[O+1]);else{var we=g instanceof THREE.LineSegments?2:1;for(O=0,L=be.length/3-1;O<L;O+=we)N.pushLine(O,O+1)}}}else if(H instanceof THREE.Geometry){if(0===(te=g.geometry.vertices).length)continue;for((he=t()).positionScreen.copy(te[0]).applyMatrix4(P),we=g instanceof THREE.LineSegments?2:1,ne=1,se=te.length;ne<se;ne++)(he=t()).positionScreen.copy(te[ne]).applyMatrix4(P),(ne+1)%we>0||(ue=R[p-2],F.copy(he.positionScreen),G.copy(ue.positionScreen),!0===s(F,G)&&(F.multiplyScalar(1/F.w),G.multiplyScalar(1/G.w),(d=o()).id=g.id,d.v1.positionScreen.copy(F),d.v2.positionScreen.copy(G),d.z=Math.max(F.z,G.z),d.renderOrder=g.renderOrder,d.material=g.material,g.material.vertexColors===THREE.VertexColors&&(d.vertexColors[0].copy(g.geometry.colors[ne]),d.vertexColors[1].copy(g.geometry.colors[ne-1])),z.elements.push(d)))}}else if(g instanceof THREE.Points){if(P.multiplyMatrices(B,y),H instanceof THREE.Geometry)for(ne=0,se=(te=g.geometry.vertices).length;ne<se;ne++)ae=te[ne],C.set(ae.x,ae.y,ae.z,1),C.applyMatrix4(P),r(C,g,c);else if(H instanceof THREE.BufferGeometry&&void 0!==(M=H.attributes).position){var be;for(O=0,L=(be=M.position.array).length;O<L;O+=3)C.set(be[O],be[O+1],be[O+2],1),C.applyMatrix4(P),r(C,g,c)}}else g instanceof THREE.Sprite&&(g.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,g.matrixWorld),C.set(y.elements[12],y.elements[13],y.elements[14],1),C.applyMatrix4(B),r(C,g,c))}return!0===v&&z.elements.sort(n),z}},THREE.SVGObject=function(e){THREE.Object3D.call(this),this.node=e},THREE.SVGObject.prototype=Object.create(THREE.Object3D.prototype),THREE.SVGObject.prototype.constructor=THREE.SVGObject,THREE.SVGRenderer=function(){function e(){for(F=0;g.firstChild;)g.removeChild(g.firstChild)}function r(e){return null!==N?e.toFixed(N):e}function t(e,t,i){var o=t.scale.x*d,n=t.scale.y*h;i.isPointsMaterial&&(o*=i.size,n*=i.size);var a="M"+r(e.x-.5*o)+","+r(e.y-.5*n)+"h"+r(o)+"v"+r(n)+"h"+r(-o)+"z",l="";(i.isSpriteMaterial||i.isPointsMaterial)&&(l="fill:"+i.color.getStyle()+";fill-opacity:"+i.opacity),s(l,a)}function i(e,t,i,o){var n="M"+r(e.positionScreen.x)+","+r(e.positionScreen.y)+"L"+r(t.positionScreen.x)+","+r(t.positionScreen.y);if(o.isLineBasicMaterial){var a="fill:none;stroke:"+o.color.getStyle()+";stroke-opacity:"+o.opacity+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;o.isLineDashedMaterial&&(a=a+";stroke-dasharray:"+o.dashSize+","+o.gapSize),s(a,n)}}function o(e,t,i,o,n){T.info.render.vertices+=3,T.info.render.faces++;var a="M"+r(e.positionScreen.x)+","+r(e.positionScreen.y)+"L"+r(t.positionScreen.x)+","+r(t.positionScreen.y)+"L"+r(i.positionScreen.x)+","+r(i.positionScreen.y)+"z";n.isMeshBasicMaterial?(b.copy(n.color),n.vertexColors!==THREE.FaceColors&&n.vertexColors!==THREE.VertexColors||b.multiply(o.color)):n.isMeshLambertMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial?(M.copy(n.color),n.vertexColors!==THREE.FaceColors&&n.vertexColors!==THREE.VertexColors||M.multiply(o.color),b.copy(z),L.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),function(e,r,t,i){for(var o=0,n=e.length;o<n;o++){var s=e[o],a=s.color;if(s.isDirectionalLight){var l=O.setFromMatrixPosition(s.matrixWorld).normalize();if((c=t.dot(l))<=0)continue;c*=s.intensity,i.r+=a.r*c,i.g+=a.g*c,i.b+=a.b*c}else if(s.isPointLight){var c;if(l=O.setFromMatrixPosition(s.matrixWorld),(c=t.dot(O.subVectors(l,r).normalize()))<=0)continue;if(0==(c*=0==s.distance?1:1-Math.min(r.distanceTo(l)/s.distance,1)))continue;c*=s.intensity,i.r+=a.r*c,i.g+=a.g*c,i.b+=a.b*c}}}(p,L,o.normalModel,b),b.multiply(M).add(n.emissive)):n.isMeshNormalMaterial&&(k.copy(o.normalModel).applyMatrix3(B).normalize(),b.setRGB(k.x,k.y,k.z).multiplyScalar(.5).addScalar(.5)),s(n.wireframe?"fill:none;stroke:"+b.getStyle()+";stroke-opacity:"+n.opacity+";stroke-width:"+n.wireframeLinewidth+";stroke-linecap:"+n.wireframeLinecap+";stroke-linejoin:"+n.wireframeLinejoin:"fill:"+b.getStyle()+";fill-opacity:"+n.opacity,a)}function n(e,r,t){var i,o=r.x-e.x,n=r.y-e.y,s=o*o+n*n;0!==s&&(o*=i=t/Math.sqrt(s),n*=i,r.x+=o,r.y+=n,e.x-=o,e.y-=n)}function s(e,r){R===e?x+=r:(a(),R=e,x=r)}function a(){x&&((v=function(e){return null==A[e]?(A[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==G&&A[e].setAttribute("shape-rendering","crispEdges"),A[e]):A[e]}(F++)).setAttribute("d",x),v.setAttribute("style",R),g.appendChild(v)),x="",R=""}var l,c,p,E,f,d,h,u,m,y,v,x,R,T=this,S=new THREE.Projector,g=document.createElementNS("http://www.w3.org/2000/svg","svg"),H=new THREE.Box2,w=new THREE.Box2,b=new THREE.Color,M=new THREE.Color,z=new THREE.Color,V=new THREE.Color,C=new THREE.Color,j=new THREE.Color,O=new THREE.Vector3,L=new THREE.Vector3,k=new THREE.Vector3,B=new THREE.Matrix3,P=new THREE.Matrix4,W=new THREE.Matrix4,A=[],F=0,G=1,N=null;this.domElement=g,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":G=1;break;case"low":G=0}},this.setClearColor=function(e){j.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,r){d=(E=e)/2,h=(f=r)/2,g.setAttribute("viewBox",-d+" "+-h+" "+E+" "+f),g.setAttribute("width",E),g.setAttribute("height",f),H.min.set(-d,-h),H.max.set(d,h)},this.setPrecision=function(e){N=e},this.clear=function(){e(),g.style.backgroundColor=j.getStyle()},this.render=function(r,s){if(s instanceof THREE.Camera!=0){var E=r.background;E&&E.isColor?(e(),g.style.backgroundColor=E.getStyle()):!0===this.autoClear&&this.clear(),T.info.render.vertices=0,T.info.render.faces=0,P.copy(s.matrixWorldInverse),W.multiplyMatrices(s.projectionMatrix,P),l=S.projectScene(r,s,this.sortObjects,this.sortElements),c=l.elements,p=l.lights,B.getNormalMatrix(s.matrixWorldInverse),function(e){z.setRGB(0,0,0),V.setRGB(0,0,0),C.setRGB(0,0,0);for(var r=0,t=e.length;r<t;r++){var i=e[r],o=i.color;i.isAmbientLight?(z.r+=o.r,z.g+=o.g,z.b+=o.b):i.isDirectionalLight?(V.r+=o.r,V.g+=o.g,V.b+=o.b):i.isPointLight&&(C.r+=o.r,C.g+=o.g,C.b+=o.b)}}(p),x="",R="";for(var f=0,v=c.length;f<v;f++){var b=c[f],M=b.material;if(void 0!==M&&0!==M.opacity)if(w.makeEmpty(),b instanceof THREE.RenderableSprite)(u=b).x*=d,u.y*=-h,t(u,b,M);else if(b instanceof THREE.RenderableLine)u=b.v1,m=b.v2,u.positionScreen.x*=d,u.positionScreen.y*=-h,m.positionScreen.x*=d,m.positionScreen.y*=-h,w.setFromPoints([u.positionScreen,m.positionScreen]),!0===H.intersectsBox(w)&&i(u,m,b,M);else if(b instanceof THREE.RenderableFace){if(u=b.v1,m=b.v2,y=b.v3,u.positionScreen.z<-1||u.positionScreen.z>1)continue;if(m.positionScreen.z<-1||m.positionScreen.z>1)continue;if(y.positionScreen.z<-1||y.positionScreen.z>1)continue;u.positionScreen.x*=d,u.positionScreen.y*=-h,m.positionScreen.x*=d,m.positionScreen.y*=-h,y.positionScreen.x*=d,y.positionScreen.y*=-h,this.overdraw>0&&(n(u.positionScreen,m.positionScreen,this.overdraw),n(m.positionScreen,y.positionScreen,this.overdraw),n(y.positionScreen,u.positionScreen,this.overdraw)),w.setFromPoints([u.positionScreen,m.positionScreen,y.positionScreen]),!0===H.intersectsBox(w)&&o(u,m,y,b,M)}}a(),r.traverseVisible(function(e){if(e instanceof THREE.SVGObject){if(O.setFromMatrixPosition(e.matrixWorld),O.applyMatrix4(W),O.z<-1||O.z>1)return;var r=O.x*d,t=-O.y*h,i=e.node;i.setAttribute("transform","translate("+r+","+t+")"),g.appendChild(i)}})}else console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.")}};
